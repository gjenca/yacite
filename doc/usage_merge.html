<p><strong>USAGE:</strong> <code>yacite merge [-h] [-u UNAME] [-s SNAME] [-d DNAME] [-v] [-b | -B] [-q]datadir</code></p>
<p><strong>DESCRIPTION:</strong></p>
<p>reads YAML stream, merges records with datadir - see the docs for merge rules</p>
<p><strong>POSITIONAL ARGUMENTS:</strong></p>
<blockquote>
<p><code>datadir</code></p>
<blockquote>
<p>data directory</p>
</blockquote>
</blockquote>
<p><strong>OPTIONAL ARGUMENTS:</strong></p>
<blockquote>
<p><code>-u, --union UNAME</code></p>
<blockquote>
<p>take union of lists - original and new</p>
</blockquote>
<p><code>-s, --set SNAME</code></p>
<blockquote>
<p>replace orginal values by new value</p>
</blockquote>
<p><code>-d, --delete DNAME</code></p>
<blockquote>
<p>delete these fields</p>
</blockquote>
<p><code>-v, --verbose</code></p>
<blockquote>
<p>be verbose</p>
</blockquote>
<p><code>-b, --bounced</code></p>
<blockquote>
<p>write bounced fields to a mergeable YAML stream</p>
</blockquote>
<p><code>-B, --strongly-bounced</code></p>
<blockquote>
<p>write strongly bounced fields to a mergeable YAML stream</p>
</blockquote>
<p><code>-q, --quiet</code></p>
<blockquote>
<p>be quiet</p>
</blockquote>
</blockquote><p><strong>HOW DOES THE MERGE COMMAND WORK:</strong></p>
<blockquote>
<p>merge means this:</p>
</blockquote>
<ul>
<li>for each <em>newrecord</em> in <em>stdin</em><ul>
<li>determine how many records in <em>datadir</em> are "very similar"
  to <em>newrecord</em>, that means
  one of the following:<ul>
<li>same key</li>
<li>same year,title,authors</li>
<li>same journal name,volume,startpage </li>
<li>same article-id</li>
</ul>
</li>
<li>if there is more than one record in datadir very similar to
  <em>newrecord</em>, then fail with an error.</li>
<li>if there is no record in datadir very similar to <em>newrecord</em>, then
  CREATE a new file as follows:<ul>
<li>generate a new key field in <em>newrecord</em> (if not present)</li>
<li>create a new file in datadir. The filename of the new file is <ul>
<li><em>datadir</em>/<em>year</em>/<em>key</em><code>.yaml</code>, if the boolean-valued 
  field <em>newrecord</em>[myown] is not true or not present</li>
<li><em>datadir</em>/myown/<em>year/</em>key<em><code>.yaml</code> if
  </em>newrecord*<code>[myown]</code> is true.</li>
</ul>
</li>
</ul>
</li>
<li>if there is exacly one record in datadir very similar to
  <em>newrecord</em>, then UPDATE the matching record (called <em>match</em> from
  now on) in <em>datadir</em> with values from
  <em>newrecord</em> according to the following rules</li>
<li>for each <em>fieldname</em> in <em>newrecord</em><ul>
<li>if <em>fieldname</em> is not present in <em>match</em>, extend <em>match</em> by
  new <em>fieldname</em>=<em>fieldvalue</em></li>
<li>if <em>fieldname</em> is present in <em>match</em> but its values are the
  same in <em>newrecord</em> and in <em>match</em>, do nothing</li>
<li>if <em>fieldname</em> is present in match and its values are
  distinct if <em>newrecord</em> and in <em>match</em> then UPDATE the
  corresponding field in <em>match</em> according to the '-s', '-u'
  or '-d' options of the 'yacite merge' command, meaning this:<ul>
<li>if <em>fieldname</em> is one of the <em>SNAME</em>s, the set the value
    in <em>match</em> to the value in <em>newrecord</em></li>
<li>if <em>fieldname</em> is one of the <em>UNAME</em>s, then the values in
    botch <em>newrecord</em> and <em>match</em> must be of the type "list of
    something". The value in <em>match</em> is extended by the value
    in in <em>newrecord</em>.</li>
<li>if <em>fieldname</em> is one of the <em>DNAME</em>s, then the
    corresponding field in <em>match</em> is deleted.</li>
<li>if <em>fieldname</em> is not present in any of <em>UNAME</em> <em>SNAME</em>
    <em>DNAME</em>, then a warning is issued with level according to
    '-v' and '-q' options.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>